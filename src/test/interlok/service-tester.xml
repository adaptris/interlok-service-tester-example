<service-test>
  <unique-id>service-tester</unique-id>
  <test-client class="embedded-jmx-test-client">
    <shared-components>
      <connections/>
      <services/>
    </shared-components>
  </test-client>
  <helpers/>
  <test-list>
    <unique-id>routing</unique-id>
    <test>
      <unique-id>routing</unique-id>
      <test-case>
        <unique-id>put</unique-id>
        <input-message-provider>
          <metadata-provider class="inline-metadata-provider">
            <metadata>
              <key-value-pair>
                <key>jettyURI</key>
                <value>/orders/123</value>
              </key-value-pair>
              <key-value-pair>
                <key>httpmethod</key>
                <value>PUT</value>
              </key-value-pair>
            </metadata>
          </metadata-provider>
          <payload-provider class="empty-payload-provider"/>
        </input-message-provider>
        <assertions>
          <assert-metadata-contains>
            <unique-id>happy-jepsen</unique-id>
            <metadata>
              <key-value-pair>
                <key>orderId</key>
                <value>123</value>
              </key-value-pair>
            </metadata>
          </assert-metadata-contains>
          <assert-next-service-id>
            <unique-id>peaceful-wing</unique-id>
            <value>put</value>
          </assert-next-service-id>
        </assertions>
      </test-case>
      <test-case>
        <unique-id>get</unique-id>
        <input-message-provider>
          <metadata-provider class="inline-metadata-provider">
            <metadata>
              <key-value-pair>
                <key>jettyURI</key>
                <value>/orders/123</value>
              </key-value-pair>
              <key-value-pair>
                <key>httpmethod</key>
                <value>GET</value>
              </key-value-pair>
            </metadata>
          </metadata-provider>
          <payload-provider class="empty-payload-provider"/>
        </input-message-provider>
        <assertions>
          <assert-metadata-contains>
            <unique-id>happy-jepsen</unique-id>
            <metadata>
              <key-value-pair>
                <key>orderId</key>
                <value>123</value>
              </key-value-pair>
            </metadata>
          </assert-metadata-contains>
          <assert-next-service-id>
            <unique-id>peaceful-wing</unique-id>
            <value>get</value>
          </assert-next-service-id>
        </assertions>
      </test-case>
      <test-case>
        <unique-id>delete</unique-id>
        <input-message-provider>
          <metadata-provider class="inline-metadata-provider">
            <metadata>
              <key-value-pair>
                <key>jettyURI</key>
                <value>/orders/123</value>
              </key-value-pair>
              <key-value-pair>
                <key>httpmethod</key>
                <value>DELETE</value>
              </key-value-pair>
            </metadata>
          </metadata-provider>
          <payload-provider class="empty-payload-provider"/>
        </input-message-provider>
        <assertions>
          <assert-metadata-contains>
            <unique-id>happy-jepsen</unique-id>
            <metadata>
              <key-value-pair>
                <key>orderId</key>
                <value>123</value>
              </key-value-pair>
            </metadata>
          </assert-metadata-contains>
          <assert-next-service-id>
            <unique-id>peaceful-wing</unique-id>
            <value>delete</value>
          </assert-next-service-id>
        </assertions>
      </test-case>
      <test-case>
        <unique-id>not-found</unique-id>
        <input-message-provider>
          <metadata-provider class="inline-metadata-provider">
            <metadata>
              <key-value-pair>
                <key>jettyURI</key>
                <value>/orders</value>
              </key-value-pair>
              <key-value-pair>
                <key>httpmethod</key>
                <value>GET</value>
              </key-value-pair>
            </metadata>
          </metadata-provider>
          <payload-provider class="empty-payload-provider"/>
        </input-message-provider>
        <assertions>
          <assert-next-service-id>
            <unique-id>peaceful-wing</unique-id>
            <value>not-found</value>
          </assert-next-service-id>
        </assertions>
      </test-case>
      <service-to-test>
        <source class="file-source">
          <file>./src/main/interlok/config/adapter.xml</file>
        </source>
        <preprocessors>
          <service-unique-id-preprocessor>
            <string>jetty-routing</string>
          </service-unique-id-preprocessor>
        </preprocessors>
      </service-to-test>
    </test>
  </test-list>
  <test-list>
    <unique-id>mapping</unique-id>
    <test>
      <unique-id>put</unique-id>
      <test-case>
        <unique-id>test-case-1</unique-id>
        <input-message-provider>
          <metadata-provider class="inline-metadata-provider">
            <metadata>
              <key-value-pair>
                <key>timestamp</key>
                <value>2018-07-04T10:52:24+0000</value>
              </key-value-pair>
            </metadata>
          </metadata-provider>
          <payload-provider class="empty-payload-provider"/>
        </input-message-provider>
        <assertions>
          <assert-xpath-equals>
            <xpath><![CDATA[/message/status/text()]]></xpath>
            <namespace-context/>
            <unique-id>elated-lewin</unique-id>
            <value>OK</value>
          </assert-xpath-equals>
          <assert-xpath-equals>
            <xpath><![CDATA[/message/timestamp/text()]]></xpath>
            <namespace-context/>
            <unique-id>berserk-bartik</unique-id>
            <value>2018-07-04T10:52:24+0000</value>
          </assert-xpath-equals>
        </assertions>
      </test-case>
      <service-to-test>
        <source class="file-source">
          <file>./src/main/interlok/config/adapter.xml</file>
        </source>
        <preprocessors>
          <service-unique-id-preprocessor>
            <string>put-response-message</string>
          </service-unique-id-preprocessor>
        </preprocessors>
      </service-to-test>
    </test>
    <test>
      <unique-id>delete</unique-id>
      <test-case>
        <unique-id>test-case-1</unique-id>
        <input-message-provider>
          <metadata-provider class="inline-metadata-provider">
            <metadata>
              <key-value-pair>
                <key>timestamp</key>
                <value>2018-07-04T10:52:24+0000</value>
              </key-value-pair>
            </metadata>
          </metadata-provider>
          <payload-provider class="empty-payload-provider"/>
        </input-message-provider>
        <assertions>
          <assert-xpath-equals>
            <xpath><![CDATA[/message/status/text()]]></xpath>
            <namespace-context/>
            <unique-id>elated-lewin</unique-id>
            <value>OK</value>
          </assert-xpath-equals>
          <assert-xpath-equals>
            <xpath><![CDATA[/message/timestamp/text()]]></xpath>
            <namespace-context/>
            <unique-id>berserk-bartik</unique-id>
            <value>2018-07-04T10:52:24+0000</value>
          </assert-xpath-equals>
        </assertions>
      </test-case>
      <service-to-test>
        <source class="file-source">
          <file>./src/main/interlok/config/adapter.xml</file>
        </source>
        <preprocessors>
          <service-unique-id-preprocessor>
            <string>delete-response-message</string>
          </service-unique-id-preprocessor>
        </preprocessors>
      </service-to-test>
    </test>
    <test>
      <unique-id>get</unique-id>
      <test-case>
        <unique-id>test-case-empty-results</unique-id>
        <input-message-provider>
          <metadata-provider class="inline-metadata-provider">
            <metadata>
              <key-value-pair>
                <key>company</key>
                <value>Adaptris</value>
              </key-value-pair>
              <key-value-pair>
                <key>timestamp</key>
                <value>2018-07-04T10:52:24+0000</value>
              </key-value-pair>
            </metadata>
          </metadata-provider>
          <payload-provider class="inline-payload-provider">
            <payload><![CDATA[<Results/>]]></payload>
          </payload-provider>
        </input-message-provider>
        <assertions>
          <assert-xpath-equals>
            <xpath><![CDATA[/message/status/text()]]></xpath>
            <namespace-context/>
            <unique-id>elated-lewin</unique-id>
            <value>OK</value>
          </assert-xpath-equals>
          <assert-xpath-equals>
            <xpath><![CDATA[/message/timestamp/text()]]></xpath>
            <namespace-context/>
            <unique-id>berserk-bartik</unique-id>
            <value>2018-07-04T10:52:24+0000</value>
          </assert-xpath-equals>
          <assert-xpath-equals>
            <xpath><![CDATA[/message/orders/company/text()]]></xpath>
            <namespace-context/>
            <unique-id>desperate-swanson</unique-id>
            <value>Adaptris</value>
          </assert-xpath-equals>
          <assert-xpath-boolean>
            <xpath><![CDATA[count(/message/orders/order) = 0]]></xpath>
            <namespace-context/>
            <unique-id>backstabbing-hoover</unique-id>
          </assert-xpath-boolean>
        </assertions>
      </test-case>
      <test-case>
        <unique-id>test-case-results</unique-id>
        <input-message-provider>
          <metadata-provider class="inline-metadata-provider">
            <metadata>
              <key-value-pair>
                <key>company</key>
                <value>Adaptris</value>
              </key-value-pair>
              <key-value-pair>
                <key>timestamp</key>
                <value>2018-07-04T10:52:24+0000</value>
              </key-value-pair>
            </metadata>
          </metadata-provider>
          <payload-provider class="inline-payload-provider">
            <payload><![CDATA[<Results><Row><orderId>123</orderId><orderItem>item1</orderItem><orderDate>2018-07-04 10:51:54.0</orderDate></Row></Results>]]></payload>
          </payload-provider>
        </input-message-provider>
        <assertions>
          <assert-xpath-equals>
            <xpath><![CDATA[/message/status/text()]]></xpath>
            <namespace-context/>
            <unique-id>elated-lewin</unique-id>
            <value>OK</value>
          </assert-xpath-equals>
          <assert-xpath-equals>
            <xpath><![CDATA[/message/timestamp/text()]]></xpath>
            <namespace-context/>
            <unique-id>berserk-bartik</unique-id>
            <value>2018-07-04T10:52:24+0000</value>
          </assert-xpath-equals>
          <assert-xpath-equals>
            <xpath><![CDATA[/message/orders/company/text()]]></xpath>
            <namespace-context/>
            <unique-id>desperate-swanson</unique-id>
            <value>Adaptris</value>
          </assert-xpath-equals>
          <assert-xpath-boolean>
            <xpath><![CDATA[count(/message/orders/order) = 1]]></xpath>
            <namespace-context/>
            <unique-id>backstabbing-hoover</unique-id>
          </assert-xpath-boolean>
        </assertions>
      </test-case>
      <service-to-test>
        <source class="file-source">
          <file>./src/main/interlok/config/adapter.xml</file>
        </source>
        <preprocessors>
          <service-unique-id-preprocessor>
            <string>get-mapping</string>
          </service-unique-id-preprocessor>
          <properties-variable-substitution-preprocessor>
            <properties>
              <key-value-pair>
                <key>mapping.url</key>
                <value>./src/main/interlok/mappings/orders.xsl</value>
              </key-value-pair>
            </properties>
          </properties-variable-substitution-preprocessor>
        </preprocessors>
      </service-to-test>
    </test>
  </test-list>
</service-test>
